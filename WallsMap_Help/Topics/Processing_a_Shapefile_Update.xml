<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="../helpproject.xsl" ?>
<topic template="Default" lasteditedby="David" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../helpproject.xsd">
  <title translate="true">Processing a Shapefile Update</title>
  <body>
    <header>
      <para styleclass="Heading1"><text styleclass="Heading1" translate="true">Processing a Shapefile Update</text></para>
    </header>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">This section assumes that you&apos;ve read </text><link displaytype="text" defaultstyle="true" type="topiclink" href="Submitting_a_Shapefile_Update" styleclass="Normal" translate="true">Submitting a Shapefile Update</link><text styleclass="Normal" translate="true">, which shows how a</text><text styleclass="Normal" style="font-style:normal;" translate="true"> contributor</text><text styleclass="Normal" translate="true">, say a data manager for a county, can quickly prepare an update archive for sending to you, the database maintainer. A shapefile in the archive will contain only the records that the contributor modified. The archive will also contain the new files linked to those records, which is convenient since the the folder hierarchy is preserved in the ZIP file.</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">On the receiving end you&apos;ll use the </text><text styleclass="Normal" style="font-weight:bold;" translate="true">Compare with other layers</text><text styleclass="Normal" translate="true"> function in almost the same way. The </text><text styleclass="Normal" style="font-style:italic;" translate="true">reference shapefile</text><text styleclass="Normal" translate="true"> is actually an up-to-date master copy of the database, perhaps one that hasn&apos;t yet been published. It could very well contain updates the current contributor hasn&apos;t seen. Also, the reference will be compared against just one shapefile, the one extracted from the contributor&apos;s update archive. The compare dialog might appear as follows:</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><image src="CompareNewRef.png" scale="100.00%" styleclass="Image Caption"></image></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">Another difference is the checked box labeled </text><text styleclass="Normal" style="font-weight:bold;" translate="true">Create updated reference</text><text styleclass="Normal" translate="true">. As the label suggests, both revised and unrevised records will be copied to the output shapefile, with unique keys assigned to the new records. Only the maintainer processing an update will want to select this option, which creates a new database snapshot -- in this case, one named </text><text styleclass="Normal" style="font-style:italic;" translate="true">TSS All Types_2014-01-27</text><text styleclass="Normal" translate="true">. The new snapshot might be named differently if you&apos;ll shortly be using it as the reference for processing another update. The output shapefile must have a different name than that of the current reference.</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">It is especially important that you leave option </text><text styleclass="Normal" style="font-weight:bold;" translate="true">Log outdated records</text><text styleclass="Normal" translate="true"> checked. That&apos;s because the contributor could have edited records originating from an older snapshot. To prevent records with older (or identical) UPDATED timestamps from being ignored, you may need to edit them yourself to incorporate information added by another contributor. This will refresh their timestamps, insuring they will be used for the new snapshot.</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">Although creating the snapshot and ZIP prematurely would be harmless, you can first perform the operation with  boxes </text><text styleclass="Normal" style="font-weight:bold;" translate="true">Include shapefile</text><text styleclass="Normal" translate="true"> and </text><text styleclass="Normal" style="font-weight:bold;" translate="true">Create updated reference</text><text styleclass="Normal" translate="true"> </text><text styleclass="Normal" style="font-style:italic;" translate="true">unchecked</text><text styleclass="Normal" translate="true">. That will create just a log detailing what records and specific field values would change if the records in </text><text styleclass="Normal" style="font-style:italic;" translate="true">TSS All Types_2014-01-10.shp</text><text styleclass="Normal" translate="true"> were replaced with the corresponding ones in </text><text styleclass="Normal" style="font-style:italic;" translate="true">UPD_Atkinson_2014-01-26.shp</text><text styleclass="Normal" translate="true">. Note that this log will likely differ from the one the contributor produced, which is contained in the update archive, </text><text styleclass="Normal" style="font-style:italic;" translate="true">UPD_Atkinson_2014-01-26.zip. </text><text styleclass="Normal" style="font-style:normal;" translate="true">As you&apos;ll see below, it&apos;s important that you base your review on the log you&apos;ve generated.</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" style="font-style:normal;" translate="true">Clicking &quot;Compare&quot; in the above dialog will perform the file scan and generate a log named</text><text styleclass="Normal" style="font-style:italic;" translate="true">TSS All Types_2014-01-27.txt.</text><text styleclass="Normal" style="font-style:normal;" translate="true"> The next prompt summarizes the results:</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><image src="CompareTotalsRef.png" scale="100.00%" styleclass="Image Caption"></image></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">Initially you&apos;ll select &quot;No.&quot; Then, at the next prompt, you&apos;ll select &quot;Yes&quot; to have the program open the log in your text editor. While reviewing the log, you may want to make changes to a few records in the update shapefile, and for that reason I suggest temporarily changing the editor&apos;s name in the </text><link displaytype="text" defaultstyle="true" type="topiclink" href="Name_for_Signing_Timestamps" styleclass="Normal" translate="true">Name for Signing Timestamps</link><text styleclass="Normal" translate="true"> dialog to the contributor&apos;s name. I recommend against routinely </text><text styleclass="Normal" style="font-style:italic;" translate="true">disabling</text><text styleclass="Normal" translate="true"> timestamping.</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">Non-trivial changes might involve merging information supplied by different contributors. For example, beneath the list of changed field values in a record, you might see this caution message:</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><table styleclass="Default" rowcount="1" colcount="1" style="width:auto; page-break-inside:avoid; background-color:#dadada;">
      <tr style="vertical-align:top">
        <td>
          <para styleclass="Normal"><text styleclass="Normal" translate="true">UPDATED_     |2013-12-30 21:04:21 George Veni --&gt; |2013-12-28 07:15:17 G. Atkinson|</text></para>
          <para styleclass="Normal" style="margin-left:0px;"><text styleclass="Normal" translate="true">     *** CAUTION: Although revised, the record&apos;s UPDATED time is earlier than that of the reference. It won&apos;t be used.</text></para>
        </td>
      </tr>
    </table></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">As it stands, this record will be ignored when the updated reference is written. But this could be a mistake. In fact, in all cases where the reference shapefile&apos;s last updater (name at left) is not the current contributor (name at right), you&apos;ll need to take a closer look. Even if Veni&apos;s edits had been older than Atkinson&apos;s edits (producing no caution), Atkinson couldn&apos;t have seen them if they were newer than the reference he used to create his update shapefile. </text><text styleclass="Normal" style="font-style:normal;" translate="true">By examining the log inside the update zip you can determine the date of that snapshot, which will appear on a line near the top of the file:</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><table styleclass="Default" rowcount="1" colcount="1" style="width:auto; background-color:#dadada;">
      <tr style="vertical-align:top">
        <td>
          <para styleclass="Normal"><text styleclass="Normal" translate="true">Reference Shapefile: TSS All Types_2013-12-01 (Date: 2013-12-01, Key Field: TSSID)</text></para>
        </td>
      </tr>
    </table></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" style="font-style:normal;" translate="true">This tells you that Atkinson&apos;s snapshot was too</text><text styleclass="Normal" translate="true"> old for him to see </text><text styleclass="Normal" style="font-style:normal;" translate="true">any</text><text styleclass="Normal" translate="true"> edits made by others after that date. For guidance on how to merge the information others may have provided, you can examine </text><text styleclass="Normal" style="font-style:normal;" translate="true">Atkinson&apos;s</text><text styleclass="Normal" translate="true"> log entry for that record to see what fields he actually edited and what their prior values were. If he made only a minor correction, you can </text><text styleclass="Normal" style="font-style:italic;" translate="true">replace</text><text styleclass="Normal" translate="true"> the update record with the reference&apos;s version, then repeat or copy that correction. As a general rule you should only revise the update shapefile and never the dated reference, which should be set non-editable.</text></para>
    <para styleclass="Normal"><anchor id="Comparing_memo_content" styleclass="Normal"></anchor></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">To help determine whether or not a proposed memo field update needs to be reconciled with other updates, you can perform a side-by-side comparison using a utility designed for this purpose. This can be as easy as a few mouse clicks in quick succession. The compare feature is described under </text><link displaytype="text" defaultstyle="true" type="topiclink" href="Editing_Records" anchor="Editing_memos" styleclass="Normal" translate="true">Editing Memo Field Content</link><text styleclass="Normal" translate="true">. If the log shows that a long report stored in a memo was updated by the contributor, and you would like to see </text><text styleclass="Normal" style="font-style:italic;" translate="true">exactly</text><text styleclass="Normal" translate="true"> what was changed, you can compare it against the same snapshot the contributor used. But in any case you want to compare it with the version in the current snapshot, and that&apos;s usually sufficient. You can do this very quickly as described in </text><link displaytype="text" defaultstyle="true" type="topiclink" href="Comparing_Memo_Field_Text" styleclass="Normal" translate="true">Comparing Memo Field Text</link><text styleclass="Normal" translate="true">.</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">Beneath the compare log&apos;s list of changed records will be the list of new records, if any, showing the values of non-empty fields. Recall that records with empty key values are recognized as new records by the compare function. Unique keys will be assigned after the log is written and you&apos;ve chosen to continue with shapefile and ZIP creation. A directive named </text><link displaytype="text" defaultstyle="true" type="topiclink" href="Template_File_Format" anchor="FLDKEY_Info" styleclass="Normal" translate="true">FLDKEY</link><text styleclass="Normal" translate="true"> in the reference&apos;s template component specifies how a key is constructed. </text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">In the information listed for a new record you might see this:</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><table styleclass="Default" rowcount="1" colcount="1" style="width:auto; background-color:#dadada;">
      <tr style="vertical-align:top">
        <td>
          <para styleclass="Normal"><text styleclass="Normal" translate="true">*** CAUTION: The COUNTY and NAME field values match that of a record in the reference: UVA0232.</text></para>
        </td>
      </tr>
    </table></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">In the TSS database it&apos;s not often that two different karst features in the same county have identical names, so you&apos;ll need to examine this record closely to avoid a possible duplication. The use of generic feature names, like &quot;cave lead&quot; can cause this message. More seriously, another contributor could have already added the feature, with the addition being newer than the contributor&apos;s snapshot. Or perhaps the existing record was missed because the feature was in a different category, or was unlocated and not visible in the map view. Another possibility is that the current contributor changed a feature&apos;s category from, say, Shelter to Cave, and instead of </text><text styleclass="Normal" style="font-style:italic;" translate="true">moving</text><text styleclass="Normal" translate="true"> the original record to the Cave shapefile (copy to layer, then delete), decided to create a new record for it. This would cause a duplication if the old record was deleted from the shapefile instead of flagged for removal (NAME prefixed with asterisk). Unfortunately, these kinds of mistakes are hard to catch when the proposed name doesn&apos;t exactly match that of the existing record.</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">To repair such duplications, you&apos;ll need to replace the blank key with the one already assigned. Then you can run the compare function again to see if a merge of information is needed. (To override the read-only status of the key field, you can either edit the update shapefile&apos;s template or use the advanced option described in </text><link displaytype="text" defaultstyle="true" type="topiclink" href="Name_for_Signing_Timestamps" styleclass="Normal" translate="true">Name for Signing Timestamps</link><text styleclass="Normal" translate="true">.)</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">A similar situation that might require a manual key assignment is indicated by this message:</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><table styleclass="Default" rowcount="1" colcount="1" style="width:auto; background-color:#dadada;">
      <tr style="vertical-align:top">
        <td>
          <para styleclass="Normal"><text styleclass="Normal" translate="true">*** CAUTION: The following records have non-blank keys not found in the reference:</text></para>
          <para styleclass="Normal"><text styleclass="Normal" translate="true"> </text></para>
          <para styleclass="Normal"><text styleclass="Normal" translate="true">UVA0239 Uvalde: unnamed sinkhole</text></para>
          <para styleclass="Normal"><text styleclass="Normal" translate="true"> . . . etc.</text></para>
        </td>
      </tr>
    </table></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">This means that another contributor removed the record (and thus the key) from the database, perhaps realizing that the &quot;unnamed sinkhole&quot; was already represented by a different record. Such records will not be exported at all, nor will their field contents be listed in the log. You&apos;ll need to check the update shapefile to see if any new information for this feature was added, and if so, determine where it belongs.</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">In the section of the log listing changes to existing records, you&apos;ll occasionally see a note similar to this one:</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><table styleclass="Default" rowcount="1" colcount="1" style="width:auto; background-color:#dadada;">
      <tr style="vertical-align:top">
        <td>
          <para styleclass="Normal"><text styleclass="Normal" translate="true">COUNTY       |Terrell| --&gt; |Crockett|</text></para>
          <para styleclass="Normal"></para>
          <para styleclass="Normal"><text styleclass="Normal" translate="true">*** NOTE: Changing the COUNTY value will require that the database maintainer create a new key.</text></para>
        </td>
      </tr>
    </table></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">Since the COUNTY value is used for key generation, you&apos;re alerted whenever it changes. If the new county is recognized as one existing in the </text><text styleclass="Normal" style="font-style:italic;" translate="true">Texas_Counties</text><text styleclass="Normal" translate="true"> shapefile (or the name </text><text styleclass="Normal" style="font-style:italic;" translate="true">Unknown</text><text styleclass="Normal" translate="true"> reserved for unlocated features), the compare function on the maintainer&apos;s end will automatically replace the key with a new one. Otherwise the process of creating a new snapshot will abort with an error message. The contributor might see the note in the log, but no action is required if the change is legitimate.</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">Once you&apos;re satisfied with the condition of the update shapefile, you can run the compare again and confirm that you want to proceed with ZIP creation.</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><image src="CompareZipRef.png" scale="100.00%" styleclass="Image Caption"></image></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><image src="CompareCompleteRef.png" scale="100.00%" styleclass="Image Caption"></image></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">The compare log will have listed, within each record summary, the pathnames of files whose links were either added or removed. The new pathnames also appear at the end of the log in two groups:  &quot;Accessible Files&quot; and &quot;Inaccessible Files (links broken).&quot; If there are files in the latter group, you&apos;ll know that you haven&apos;t finished copying files from the update archive to their standard locations (possibly reconditioning them in the process -- see below). In any case, your final step might be to open a </text><link displaytype="text" defaultstyle="true" type="topiclink" href="Getting_Started" anchor="Header_context_menu" styleclass="Normal" translate="true">table view</link><text styleclass="Normal" translate="true"> of the output shapefile, right-click on each of the appropriate memo field names and select &quot;Find broken image links.&quot;</text></para>
    <para styleclass="Normal"><anchor id="Init_ignored_fields" styleclass="Normal"></anchor></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Subheader" translate="true">Initialization of Ignored Fields</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">The Compare dialog in the above example will show that no </text><text styleclass="Normal" style="font-weight:normal; font-style:italic;" translate="true">ignored fields</text><text styleclass="Normal" style="font-weight:normal; font-style:normal;" translate="true"> have been selected. Those would be fields whose values are either copied straight from the reference or initialized. Since their values in the compared files are ignored, you&apos;ll see nothing about them in the compare log. If you use this feature routinely, you can insert one or more </text><link displaytype="text" defaultstyle="true" type="topiclink" href="Template_File_Format" anchor="FLDIGNORE" styleclass="Normal" style="font-weight:normal; font-style:normal;" translate="true">FLDIGNORE</link><text styleclass="Normal" style="font-weight:normal; font-style:normal;" translate="true"> directives in the reference&apos;s template component, with each specifying a field to ignore by default. The directive also has an optional initialization parameter that&apos;s relevant only when you&apos;ve selected the </text><text styleclass="Normal" style="font-weight:normal; font-style:italic;" translate="true">Create updated reference</text><text styleclass="Normal" style="font-weight:normal; font-style:normal;" translate="true"> option. For example, in the directive</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" style="font-weight:normal; font-style:normal;" translate="true">.FLDIGNORE PROTECTION &quot;|TNC_Protection::TNCMEMO|&quot;</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" style="font-weight:normal; font-style:italic;" translate="true">TNC_Protection </text><text styleclass="Normal" style="font-weight:normal; font-style:normal;" translate="true">is assumed to be a polygon shapefile layer with a field named TNCMEMO. If an output record&apos;s</text><text styleclass="Normal" style="font-weight:normal; font-style:italic;" translate="true"> </text><text styleclass="Normal" style="font-weight:normal; font-style:normal;" translate="true">point is found inside the polygon of a record in </text><text styleclass="Normal" style="font-weight:normal; font-style:italic;" translate="true">TNC_Protection</text><text styleclass="Normal" style="font-weight:normal; font-style:normal;" translate="true">, then the PROTECTION field of the output record will be initialized with the content of TNCMEMO. The source and destination fields in this case can be memo fields. The initialization only happens in new records and in records whose locations are being revised. The PROTECTION field, like the key field, is not intended to be directly edited. A major benefit of this feature is that the </text><text styleclass="Normal" style="font-weight:normal; font-style:italic;" translate="true">TNC_Protection</text><text styleclass="Normal" style="font-weight:normal; font-style:normal;" translate="true"> shapefile, which can be very large, doesn&apos;t need to be part of the released database project.</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Subheader" translate="true">Exporting Category Shapefiles from the Snapshot</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">The final step in preparing a database project for release might be to split the new snapshot into a set of editable shapefile layers based on the values of certain fields -- convenient for labeling, toggling visibility, and targeting searches. This is most easily done by opening the snapshot by itself and then exporting it using a set of prepared </text><link displaytype="text" defaultstyle="true" type="topiclink" href="Template_File_Format" styleclass="Normal" translate="true">export templates</link><text styleclass="Normal" translate="true">. The TSS uses specially-named templates, such as </text><text styleclass="Normal" style="font-style:italic;" translate="true">Export_TSS Caves.tmpshp</text><text styleclass="Normal" translate="true">, </text><text styleclass="Normal" style="font-style:italic;" translate="true">Export_TSS Sinks and Cavities.tmpshp</text><text styleclass="Normal" style="font-style:normal;" translate="true">, etc., to select only specific records in the snapshot to include in the output. The templates accomplish this with directives containing expressions of the form</text><text styleclass="Normal" translate="true"> &quot;=(value1|value2|...)&quot; following a source field name. The only significance of </text><text styleclass="Normal" style="font-style:normal;" translate="true">the special names</text><text styleclass="Normal" translate="true"> is that whenever a template with prefix &quot;Export_&quot; is selected by browsing a folder&apos;s content, the </text><text styleclass="Normal" style="font-style:italic;" translate="true">Output file</text><text styleclass="Normal" translate="true"> box of the Export dialog is automatically filled with the correct pathname, say </text><text styleclass="Normal" style="font-style:italic;" translate="true">...\TSS Caves.shp</text><text styleclass="Normal" translate="true">. This saves time and helps avoid errors.</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Subheader" translate="true">TSS Conventions Regarding Image File Size and Format</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal" style="margin-left:0px;"><text styleclass="Normal" style="font-style:normal;" translate="true">Upon receiving an update, you might consider the approach TSS has taken with image files. The &quot;Save for Web&quot; function in Adobe Photoshop has proved to be an effective tool. For map images, the preferred format is PNG-8 (8 colors if grayscale or up to 256 colors if not). This isn&apos;t the standard &quot;true color&quot; PNG, or PNG-24, which is generally good for archiving. If the original is a 2-color bitmap, it must be converted to grayscale before it&apos;s resized. After resizing it should have the resolution needed for a viewer to see all important details and text, possibly after opening the file as a document and zooming to specific regions. The widths of map images, therefore, can range from 600 to 5000 pixels or larger. For photos, JPEG (JPG) remains the best format option. The longest dimension of a linked photo is typically 600 to 800 pixels, with a few reaching 1024 pixels.</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"></para>
  </body>
</topic>
