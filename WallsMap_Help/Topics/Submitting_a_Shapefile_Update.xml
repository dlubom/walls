<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="../helpproject.xsl" ?>
<topic template="Default" lasteditedby="David" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../helpproject.xsd">
  <title translate="true">Submitting a Shapefile Update</title>
  <body>
    <header>
      <para styleclass="Heading1"><text styleclass="Heading1" translate="true">Submitting a Shapefile Update</text></para>
    </header>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">A function named </text><text styleclass="Normal" style="font-weight:bold;" translate="true">Compare with other layers</text><text styleclass="Normal" translate="true"> simplifies, for a contributor, the task of consolidating record updates for sending to the primary database maintainer. While it&apos;s basically a compare function, it can quickly produce a ZIP </text><text styleclass="Normal" style="font-style:italic;" translate="true">update archive</text><text styleclass="Normal" translate="true"> containing only the necessary records and files. It also writes a detailed log showing precisely what changes were made. The following tutorial assumes you&apos;re a </text><text styleclass="Normal" style="font-style:italic;" translate="true">Texas Speleological Survey</text><text styleclass="Normal" translate="true"> data manager compiling data for some region of Texas.</text></para>
    <para styleclass="Normal" style="margin-left:0px;"></para>
    <para styleclass="Normal" style="margin-left:0px;"><text styleclass="Normal" translate="true">With the</text><text styleclass="Normal" style="font-style:italic;" translate="true"> TSS_Data</text><text styleclass="Normal" translate="true"> project loaded in WallsMap, open the Layers Window and right-click on the </text><text styleclass="Normal" style="font-style:italic;" translate="true">reference shapefile</text><text styleclass="Normal" style="font-style:normal;" translate="true"> that was supplied with the downloaded project. </text><text styleclass="Normal" translate="true">It should be an </text><text styleclass="Normal" style="font-style:italic;" translate="true">unedited</text><text styleclass="Normal" translate="true"> snapshot of the entire database, with the release date being part of its name.</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><image src="CompareLayers.png" scale="100.00%" styleclass="Image Caption"></image></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" style="font-style:normal;" translate="true">If option </text><text styleclass="Normal" style="font-style:italic;" translate="true">Compare with other layers</text><text styleclass="Normal" translate="true">&#32;</text><text styleclass="Normal" style="font-style:normal;" translate="true">appears in the menu, the shapefile meets</text><text styleclass="Normal" translate="true"> the basic requirement for being the </text><text styleclass="Normal" style="font-style:italic;" translate="true">reference</text><text styleclass="Normal" translate="true"> in a compare operation. That means it has a </text><link displaytype="text" defaultstyle="true" type="topiclink" href="Template_File_Format" styleclass="Normal" translate="true">template component</link><text styleclass="Normal" translate="true"> identifying the </text><text styleclass="Normal" style="font-style:italic;" translate="true">key field</text><text styleclass="Normal" translate="true"> needed to link comparable records. This attribute field, which is normally maintained automatically and never manually edited, will be populated with unique non-blank values. For another shapefile to be compared against the reference, it must have an attribute field with the same name, type, and length as the reference&apos;s key field. In this situation, where we&apos;re preparing an update as opposed to receiving one, the compared shapefiles will have originated from the same snapshot, so their structures should exactly match that of the reference.</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">The key field used by the </text><text styleclass="Normal" style="font-style:normal;" translate="true">TSS</text><text styleclass="Normal" translate="true"> is TSSID, a 4-digit integer prefixed with a 3-character county code, such as VAL0175. The program obtains this information when it processes the reference&apos;s template component (</text><text styleclass="Normal" style="font-style:italic;" translate="true">TSS All Types_2014-02-03.tmpshp</text><text styleclass="Normal" translate="true">). The template&apos;s </text><link displaytype="text" defaultstyle="true" type="topiclink" href="Template_File_Format" anchor="FLDKEY_Info" styleclass="Normal" translate="true">FLDKEY</link><text styleclass="Normal" translate="true"> directive also specifies that items in the log will be sorted by NAME (label field) within COUNTY, and also that features with coordinates north of latitude 32.2 and west of longitude -103.3 will be regarded as</text><text styleclass="Normal" style="font-style:normal;" translate="true"> being </text><text styleclass="Normal" style="font-style:italic;" translate="true">unlocated</text><text styleclass="Normal" style="font-style:normal;" translate="true">. When the database is updated, all unlocated features will be assigned these coordinates.</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">Unlike the reference shapefile, the compared shapefiles can have new records with blank key values. Those records will have a CREATED timestamp tagged with the editor&apos;s name. Other records that have been revised will have a similar UPDATED timestamp that&apos;s newer than that of the corresponding record in the reference.</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">In this example, the shapefiles of interest are five visible ones grouped under folder </text><text styleclass="Normal" style="font-style:italic;" translate="true">TSS Categories</text><text styleclass="Normal" translate="true">. They aren&apos;t required to have these names, nor must they reside in the same disk folder.</text><text styleclass="Font Style" style="font-family:Arial; font-size:11pt; font-weight:normal; font-style:normal; text-decoration:none; text-transform:none; vertical-align:baseline; color:#000000; background-color:transparent; letter-spacing:normal; letter-scaling:100%;" translate="true"> They should, however, be stored in a folder where their file links are valid, allowing the retrieval of any new files for the archive</text><text styleclass="Normal" translate="true">. Before initiating a comparison, make sure that these shapefiles have checked visibility boxes. That allows them to appear in the dialog that opens when you select </text><text styleclass="Normal" style="font-style:italic;" translate="true">Compare with other layers</text><text styleclass="Normal" translate="true">:</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><image src="CompareDlg.png" scale="100.00%" styleclass="Image Caption"></image></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">Initially, all visible shapefiles suitable for comparing with the reference shapefile will appear on the left side under </text><text styleclass="Normal" style="font-weight:bold;" translate="true">Candidate Shapefiles</text><text styleclass="Normal" translate="true">. As specified in the reference&apos;s template component, they will be </text><text styleclass="Normal" style="font-style:italic;" translate="true">point</text><text styleclass="Normal" translate="true"> shapefiles having TSSID as one of its fields. They will also have the COUNTY field that&apos;s required for key generation when the update is processed.</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">Note that we&apos;ve moved the five shapefiles that we normally edit to the dialog&apos;s right side using the middle set of buttons. We&apos;ve left one candidate unselected because it wasn&apos;t meant to be compared. In fact, including it with the others would cause the compare operation to detect duplicate keys and terminate with an error message. The selected set of shapefiles must collectively have records with either unique keys or empty (blank) keys.</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal" style="margin-left:0px;"><text styleclass="Normal" translate="true">Although five shapefiles have been selected, only a single shapefile will be generated by the compare function. It will lump together all the new and revised records found in the selected set and produce </text><text styleclass="Normal" style="font-style:italic;" translate="true">UPD_Reddell_2014-02-17.shp</text><text styleclass="Normal" translate="true">, storing it both inside and outside the ZIP file. The only reason we&apos;re comparing the reference against multiple files is that a TSS database release contains both a complete snapshot and an editable copy of it in the form of five different map layers. At least initially, the layers are distinguished by karst feature type, but since karst type is also an attribute field value, and one that can be edited, the particular source shapefile of an updated record is of no concern to the person processing the update.</text></para>
    <para styleclass="Normal" style="margin-left:0px;"></para>
    <para styleclass="Normal" style="margin-left:0px;"><text styleclass="Normal" translate="true">The option </text><text styleclass="Normal" style="font-weight:bold;" translate="true">Create updated reference</text><text styleclass="Normal" translate="true"> is for use by the database maintainer. As the submitter of the update, you should leave it unchecked since you want the output to include only the records you&apos;ve changed.</text></para>
    <para styleclass="Normal" style="margin-left:0px;"></para>
    <para styleclass="Normal" style="margin-left:0px;"><text styleclass="Normal" translate="true">You should leave option </text><text styleclass="Normal" style="font-weight:bold;" translate="true">Log outdated records</text><text styleclass="Normal" translate="true"> checked. This will insure that even records that don&apos;t have newer UPDATED timestamps are compared with the reference&apos;s versions and listed with a caution message if differences are found. There shouldn&apos;t be any if you&apos;ve chosen the correct shapefile to compare with other layers, the latter originating from the same database snapshot. In any case, outdated records </text><text styleclass="Normal" style="font-style:italic;" translate="true">will not</text><text styleclass="Normal" translate="true"> be included in the update you&apos;re creating.</text></para>
    <para styleclass="Normal" style="margin-left:0px;"></para>
    <para styleclass="Normal" style="margin-left:0px;"><text styleclass="Normal" translate="true">Values for an optional set of </text><text styleclass="Normal" style="font-weight:bold; font-style:normal;" translate="true">ignored fields</text><text styleclass="Normal" style="font-weight:normal;" translate="true"> (see button at dialog&apos;s top-right) won&apos;t take part in the comparison, nor will they appear in the log</text><text styleclass="Normal" translate="true">. Ordinarily, if there are any ignored fields, they will have been identified in the reference&apos;s template component, in which case you&apos;ll routinely leave this dialog setting unchanged.</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">In addition to choosing whether or not to create a ZIP as opposed to just a log, you may want to change the suggested </text><text styleclass="Normal" style="font-weight:bold;" translate="true">Base pathname</text><text styleclass="Normal" translate="true"> for the output files. The program constructs a suggestion based on this format:</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">&lt;path of reference shapefile&gt;\UPD_&lt;editor&apos;s last name&gt;_&lt;current date&gt;</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">You can store the files anywhere, but I recommend you choose either the reference&apos;s folder or a sibling folder at the same level. That&apos;s because the generated shapefile (the copy of it remaining outside the ZIP) would then have valid file links. It&apos;s convenient to be able to add it to your project and examine it along with the log file. You might discover mistakes that you, rather than the maintainer, can easily fix.</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">When you click the Compare button in the above dialog, a summary message similar to this should appear after a few seconds:</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><image src="CompareTotals.png" scale="100.00%" styleclass="Image Caption"></image></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">At this point you can choose &quot;No&quot;, in which case the program will optionally open </text><text styleclass="Normal" style="font-style:italic;" translate="true">UPD_Reddell_2014-02-17.txt</text><text styleclass="Normal" translate="true"> in your text editor. The log is a detailed summary of the compare results, listing all proposed record additions and updates. When reviewing a lengthy log you may want to first search for &quot;*** NOTE&quot; and &quot;*** CAUTION&quot; (or simply &quot;*** &quot;) to see what the compare function considered worthy of your attention. For example, a common mistake is adding a new record for a feature that already exists in the database, possibly in a different category or with a different location status. In the TSS database, this is suspected when a new record has the same NAME and COUNTY as that of an existing record.</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">If you respond &quot;Yes&quot; to the above prompt, you&apos;ll soon you&apos;ll see another prompt</text><text styleclass="Normal" style="font-style:normal;" translate="true"> with a bit of additional information about the requested ZIP:</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><image src="CompareZip.png" scale="100.00%" styleclass="Image Caption"></image></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">That many new linked files is unusual for a single update. In fact, in this demonstration I&apos;ve used the compare function to summarize all changes made to the TSS database over a two-month period beginning Dec 1, 2013.</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">Finally, choosing OK initiates archive creation. After a few more seconds, during which the names of added files scroll by rapidly, you should see this:</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><image src="CompareComplete.png" scale="100.00%" styleclass="Image Caption"></image></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">The ZIP file can be sent by email, if small enough, or placed in a cloud storage folder if you&apos;re sharing one with the database maintainer. An alternative is to remove some or all of the image files from the ZIP and send them as separate email attachments, either individually or in groups. The pared-down archive will likely be small enough to email.</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" style="font-style:normal;" translate="true">While it&apos;s </text><text styleclass="Normal" translate="true">important</text><text styleclass="Normal" style="font-style:normal;" translate="true"> to link submitted image files to the appropriate database records, ideally placing them in the folder structure TSS has adopted, I suggest contributors not resize the files unless they&apos;re too large to be sent as attachments. When they are received, most image files are archived for the TSS collection before being conditioned for the </text><text styleclass="Normal" style="font-style:italic;" translate="true">TSS_Data</text><text styleclass="Normal" style="font-style:normal;" translate="true"> project. The linked photos and map scans are optimized for screen viewing, with the file extension being changed in some cases. </text><text styleclass="Font Style" style="font-family:Arial; font-size:11pt; font-weight:normal; font-style:normal; text-decoration:none; text-transform:none; vertical-align:baseline; color:#000000; background-color:transparent; letter-spacing:normal; letter-scaling:100%;" translate="true">The body of the original file name is preserved. </text><text styleclass="Normal" style="font-style:normal;" translate="true">The benefit of resizing and changing formats is a dramatically smaller project, with images that load faster and look as good or better on screen.</text></para>
    <para styleclass="Normal" style="margin-left:0px;"></para>
    <para styleclass="Normal" style="margin-left:0px;"><text styleclass="Normal" translate="true">To see how an update archive is handled on the receiving end, see </text><link displaytype="text" defaultstyle="true" type="topiclink" href="Processing_a_Shapefile_Update" styleclass="Normal" translate="true">Processing a Shapefile Update</link><text styleclass="Normal" translate="true">.</text></para>
    <para styleclass="Normal" style="margin-left:0px;"></para>
    <para styleclass="Normal"><text styleclass="Normal" style="font-weight:bold;" translate="true">General Usage Note:</text><text styleclass="Normal" translate="true"> For other applications of the compare function, the reference and compared shapefiles might well have different attribute table structures. Only the fields with matching names are examined in that case. Also, the types (fixed character vs. memo) and lengths of compared fields don&apos;t have to match exactly. Field values are reformatted as necessary for the output shapefile, which will have the same structure as the reference. Values for fields not present in the reference are discarded. Values for fields not present in the compared shapefiles are either copied from the reference or set blank when a record is being added. These features can be useful for the maintainer when processing an update, or in general when merging data from multiple shapefiles.</text></para>
    <para styleclass="Normal"></para>
  </body>
</topic>
