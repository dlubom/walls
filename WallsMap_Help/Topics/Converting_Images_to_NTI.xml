<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="../helpproject.xsl" ?>
<topic template="Default" lasteditedby="David" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../helpproject.xsd">
  <title translate="true">Converting Images to NTI Format</title>
  <body>
    <header>
      <para styleclass="Heading1"><text styleclass="Heading1" translate="true">Converting Images to NTI Format</text></para>
    </header>
    <para styleclass="Normal" style="margin-left:0px;"></para>
    <para styleclass="Normal" style="margin-left:0px;"><text styleclass="Normal" translate="true">Whether georeferenced or not, any raster image the program can open can optionally be converted to an NTI file. This is basically a container for individually-compressed 256-pixel x 256-pixel tiles. &#160;When large image files are likely to remain as background layers in a GIS project, there&apos;s no reason not to perform this quick operation. Since the NTI format was designed for efficient caching and screen display at different zoom levels, you&apos;ll likely see a significant gain in speed.</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><image src="nti_export.png" scale="100.00%" styleclass="Image Caption"></image></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">The NTI export dialog (shown above) is accessed by clicking the </text><text styleclass="Normal" style="font-style:italic;" translate="true">Export</text><text styleclass="Normal" translate="true"> button in the Layers window whenever the image layer is highlighted. The dialog lets you specify a rectangle in the original image, one that defines the region to be exported. No rescaling will occur; you&apos;re simply choosing which pixels to be included. Here you can also modify the suggested output file pathname. When you&apos;re experimenting, you may want to add a suffix to the name to indicate which tile compression options were chosen. In this example, the option in effect is JPEG2000, with the degree of &quot;lossiness&quot; such that image data will be compressed to about 5% of its uncompressed size.</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">When the operation completes you&apos;ll see a report like the following:</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><image src="nti_export_exit.png" scale="100.00%" styleclass="Image Caption"></image></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">If you&apos;re interested in quickly comparing a lossy-compressed exported file with the source (or with other exported versions), check one of the two boxes labeled </text><text styleclass="Normal" style="font-style:italic;" translate="true">Open file</text><text styleclass="Normal" translate="true"> and </text><text styleclass="Normal" style="font-style:italic;" translate="true">Add layer to project.</text><text styleclass="Normal" translate="true"> The first choice allows a side-by-side comparison, with views optionally </text><link displaytype="text" defaultstyle="true" type="topiclink" href="Getting_Started" anchor="Synchonized_Views" styleclass="Normal" translate="true">synchronized</link><text styleclass="Normal" translate="true">. The second choice, which is enabled only for georeferenced images, is to add the new file to the source file&apos;s layer set. This let&apos;s you see the effects of lossy compression by toggling visibility check boxes in the Layers window. If there&apos;s no need to compare, you can check a third box labeled </text><text styleclass="Normal" style="font-style:italic;" translate="true">Replace source layer</text><text styleclass="Normal" style="font-style:normal;" translate="true">. This will</text><text styleclass="Normal" translate="true"> remove the source file from its layer set and insert the new file in its place. No disk file is deleted.</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><anchor id="Compression_Options" styleclass="Normal"></anchor></para>
    <para styleclass="Heading1"><text styleclass="Subheader" translate="true">Compression Options</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><image src="nti_formats.png" scale="100.00%" styleclass="Image Caption"></image></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">The </text><text styleclass="Normal" style="font-style:italic;" translate="true">Options</text><text styleclass="Normal" translate="true"> button in the NTI Export dialog opens the dialog shown above. There are four compression methods to pick from. The two lossy ones are appropriate for most background imagery, where uncompressed data sizes can range from tens of megabytes to tens of gigabytes. By allowing some information to be discarded, we can usually compress data to 3-10% of its original size without there being a perceptible loss of image detail or quality. With a lossless method we can&apos;t expect much better than a 50% compression ratio. Since export operations and on-screen comparisons can be performed fairly quickly, one can experiment to find the best balance between space savings and quality.</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" style="font-weight:bold;" translate="true">WebP</text><text styleclass="Normal" translate="true"> is a lossy image format recently </text><link displaytype="text" defaultstyle="true" type="weblink" href="https://developers.google.com/speed/webp/" target="_blank" styleclass="Normal" translate="true">introduced by Google</link><text styleclass="Normal" translate="true">. Unlike the default </text><text styleclass="Normal" style="font-weight:normal;" translate="true">JPEG2000 </text><text styleclass="Normal" translate="true">option, for which you specify a target compressed data size, the WebP option accepts a &quot;quality&quot; specification between 20 and 100. (The 100 setting is not the same as lossless; the format actually has a lossless variety but it&apos;s not implemented here.) You can also pick one of six profile settings (</text><text styleclass="Normal" style="font-style:italic;" translate="true">Default</text><text styleclass="Normal" translate="true">, </text><text styleclass="Normal" style="font-style:italic;" translate="true">Picture</text><text styleclass="Normal" translate="true">, </text><text styleclass="Normal" style="font-style:italic;" translate="true">Photo</text><text styleclass="Normal" translate="true">, </text><text styleclass="Normal" style="font-style:italic;" translate="true">Drawing</text><text styleclass="Normal" translate="true">, </text><text styleclass="Normal" style="font-style:italic;" translate="true">Icon</text><text styleclass="Normal" translate="true">, and </text><text styleclass="Normal" style="font-style:italic;" translate="true">Text</text><text styleclass="Normal" style="font-style:normal;" translate="true">) that supposedly tailor the algorithm to the type of image. These are the same settings offered by Google&apos;s open source compression program, </text><text styleclass="Normal" style="font-style:italic;" translate="true">cwebp v0.3.1</text><text styleclass="Normal" style="font-style:normal;" translate="true">. When applying them to GIS files of various kinds, I haven&apos;t yet noticed a significant advantage in using profiles other than </text><text styleclass="Normal" style="font-style:italic;" translate="true">Default</text><text styleclass="Normal" style="font-style:normal;" translate="true">.</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" style="font-weight:bold; font-style:normal;" translate="true">JPEG2000</text><text styleclass="Normal" style="font-style:normal;" translate="true"> offers size choices ranging between </text><text styleclass="Normal" translate="true">1% and 50% of the uncompressed data. It also has a setting,</text><text styleclass="Normal" style="font-style:normal;" translate="true"> labeled </text><text styleclass="Normal" style="font-style:italic;" translate="true">Best lossy</text><text styleclass="Normal" style="font-style:normal;" translate="true">, that</text><text styleclass="Normal" translate="true"> instructs the</text><text styleclass="Normal" style="font-style:normal;" translate="true"> compression algorithm </text><text styleclass="Normal" translate="true">to search for what it considers to be a good balance between quality (lack of image degradation) and size reduction. Most likely this setting will produce a larger file than what you would need for sufficient quality. Finally, at the bottom of the drop-down list, you&apos;ll see a </text><text styleclass="Normal" style="font-style:italic;" translate="true">Lossless</text><text styleclass="Normal" translate="true"> setting. More often than not, I&apos;ve found that option to be less effective than LOCO-I for tile compression.</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" style="font-weight:bold;" translate="true">LOCO-I </text><text styleclass="Normal" translate="true">is the best method I&apos;ve found for compressing 256-pixel x 256-pixel tiles losslessly, especially if the source image is a 24-bit color photo. For drawings, or scanned topos, which usually have large areas of uniform color, the better-known </text><text styleclass="Normal" style="font-weight:bold;" translate="true">Deflate</text><text styleclass="Normal" translate="true"> (zip) method might perform better. Since both methods can benefit from the application of a simple transformation of the Red, Green, and Blue 8-bit color bands before they&apos;re acted upon, an </text><text styleclass="Normal" style="font-style:italic;" translate="true">Applied RGB Filter</text><text styleclass="Normal" translate="true"> option is available (see above). The </text><text styleclass="Normal" style="font-style:italic;" translate="true">R-G, G, B-G</text><text styleclass="Normal" translate="true"> choice usually works best in my experience.</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Subheader" translate="true">Special Case of Paletted Image Files</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">Regardless of the chosen compression method, if the source image is </text><text styleclass="Normal" style="font-style:normal;" translate="true">paletted</text><text styleclass="Normal" style="font-style:italic;" translate="true">&#32;</text><text styleclass="Normal" style="font-style:normal;" translate="true">(colors stored as byte indexes into a 256-color palette)</text><text styleclass="Normal" translate="true">, a full-resolution copy of it is stored in the NTI file using the</text><text styleclass="Normal" style="font-weight:normal;" translate="true"> lossless deflate </text><text styleclass="Normal" translate="true">method. Only the smaller-resolution copies (</text><text styleclass="Normal" style="font-style:normal;" translate="true">overviews)</text><text styleclass="Normal" translate="true"> are compressed using the chosen method. This isn&apos;t the case with 24-bit RGB images, where both the full-resolution copy and the overviews are subject to lossy compression if that was the choice. This means that when you view converted USGS topographic map images, which are normally paletted, you&apos;ll see no image degradation at zoom levels greater than 50%. (At smaller zoom levels an overview is displayed.) &#160;Also, no image information is lost if you later decide to use the exported NTI as the source for a new NTI export, where possibly different compression settings are used to create the overviews.</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Subheader" translate="true">SSIM Computation</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">With both the WebP and JPEG2000 options you can choose to compute a </text><link displaytype="text" defaultstyle="true" type="weblink" href="http://en.wikipedia.org/wiki/Structural_similarity" target="_blank" styleclass="Normal" translate="true">Structural Similarity</link><text styleclass="Normal" translate="true"> (SSIM) index for the purpose of experimentation. The larger this number, the less image degradation (at least of a certain kind) will have been caused by lossy compression. The calculation of SSIM, which is based on a grayscale version of the image, is complex enough to quadruple the processing time, but thereafter the index will be available for display in the NTI file&apos;s Properties window. You can use it along with visual inspection to compare the effects of the various compression options.</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">Since SSIM is calculated only for the full-resolution portion of an NTI file (and only for whole tiles), the option is disabled for paletted images where only the overviews are lossy compressed. The option is also grayed out for the lossless methods, all of which would produce the largest possible SSIM value of 100.</text></para>
    <para styleclass="Heading1"></para>
    <para styleclass="Heading1"><text styleclass="Subheader" translate="true">Recommendations</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">My tests indicate that JPEG2000 is about 50% faster than WebP when compressing but somewhat slower than WebP when decompressing. While visual quality and SSIM values are comparable for similar-sized output, the compression artifacts are qualitatively different. For example, JPEG2000 can give a blurry or mottled effect to areas with near-uniform color, whereas WebP tends to smooth out variations that might, in some cases, be considered useful detail. These effects can favor either method over the other depending on the type of image and the degree of compression. Given what I&apos;ve seen so far, I would recommend WebP for scanned line art, such as topos and drawings, and JPEG2000 for aerial photography.</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" style="font-weight:normal; font-style:normal;" translate="true">Also see </text><link displaytype="text" defaultstyle="true" type="topiclink" href="Getting_Started" anchor="GeneratingNTIfiles" styleclass="Normal" style="font-weight:normal;" translate="true">Generating NTI Files for Efficient Viewing</link><text styleclass="Normal" style="font-weight:normal;" translate="true"> in the Getting Started section.</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"></para>
  </body>
</topic>
