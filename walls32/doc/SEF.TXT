
#: 888 S0/CompuServe Mail  [MAIL]
    28-May-92 20:51 MDT
Sb: #3336: Another proposed exchange format (SEF)
Fm: >INTERNET:cavers@m2c.org


Sender: jds@m2c.org
Received: from M2C.M2C.ORG by ihc.compuserve.com (5.65/5.910516)
        id AA00731; Thu, 28 May 92 22:46:22 -0400
Received: by m2c.m2c.org (5.57/sendmail.28-May-87)
        id AA25163; Thu, 28 May 92 22:40:05 -0400
Return-Path: <jds@zeus.m2c.org>
Received: by zeus.m2c.org  id AA24644; Thu, 28 May 92 22:38:19 -0400
Date: Thu, 28 May 92 22:38:19 -0400
Message-Id: <9205290238.AA24644@zeus.m2c.org>
To: realcavers@m2c.org
From: cavers@m2c.org (Cavers Forum)
Reply-To: cavers@m2c.org (Cavers Forum)
Errors-To: cavers-request@m2c.org
X-Reminder-1:  *** Do Not Reproduce This Message  ***
X-Reminder-2:  *** Without Permission From Author ***
Originally-From: Doug Dotson <e2cs002@fre.fsu.umd.edu>
Subject: #3336: Another proposed exchange format (SEF)


From: Doug Dotson <e2cs002@fre.fsu.umd.edu>
Date: Thu, 28 May 1992 15:45:40 EDT
Subject: Another proposed exchange format (SEF)

Dear Computer Cave Mapper Types:

This document describes the structure of SMAPS Exchange Format (SEF)
files.  Mel Park has recently dubbed SEF as Standard Exchange Format
indicating his desire to perhaps propose that this be the basis for a
defacto standard for exchanging data.  I think this is an excellent
idea.  Therefore from this point in time, SEF will stand for Standard
Exchange Format.

I will be making available a program which converts an SEF file into
a fixed format.  This program is not intended so much as a standalone
utility in itself but rather as a template for building SEF import
processors for existing programs.  The program consists of six modules
written in ANSI C and compiles under Microsoft C Version 6.0a.  I will
concatenate these files into <32K chunks and mail them out to anyone
who asks for them.

As you read this document, keep in mind that this is an exchange
format.  It is not intended to be a universal input language for
survey data processing systems.  It is not intended to EVER be entered
using an editor or printed out for that matter.

This is intended as food for thought for the open discussion during
Monday afternoon at Convention.  Any input is welcome.

Good Caving & Computing,
Doug Dotson
Internet: dotson@fre.fsu.umd.edu
Bitnet: dotson@fre.towson.edu

ps. Please post any suggestions to the forum to help further discussion.

==========================================================================

        SEF - An exchange standard for porting survey data
        --------------------------------------------------

Standard Exchange Format (SEF) files are used to import raw survey data
into and out of cave survey processing systems such as SMAPS.  The
exchange mechanism currently supports two types of data within an exchange
file.  These two data types are Control Point groups which define the
locations of points in space and Compass and Tape Survey groups based
on the use of a magnetic compass and a tape.

1. General information.

An SEF consists of the actual survey and control point groups interspersed
with directives which define how the data should be interpreted.  In
general, a line beginning with a space in the first column is treated as
a data line, a line beginning with a pound sign (#) is a directive, and
any other line is treated as a comment.  Each line must be terminated
with either a linefeed (UNIX style) or a carriage return/linefeed (MSDOS
style).  Upper and lowercase are not distinct for directives but may be
distinct for control point and survey station names in some programs.
Each exchange file may have any number of Compass and Tape Survey or
Control Point groups.  A simple example is shown below:

        #ctsurvey This is a compass & tape survey group.
                                :
                                :
                Directives and survey data go here
                                :
                                :
        #endctsurvey

        #cpoint This is a control point group.
                                :
                                :
                Directives and control point data go here
                                :
                                :
        #endcpoint

The string of characters following the "#ctsurvey" and "#cpoint" directives
is the descriptive name of the file if the file has been exported by
SMAPS.  If the file is being imported into SMAPS then the string
following the directive will be used as the descriptive name of the
file created to contain the data within SMAPS.

2. The "#include" directive.

At any point within an SEF, an "#include" directive will direct the
import processor to insert the specified file into the input data stream.
If a filename is given then the file is assumed to be in the same
directory as the SEF being processed.  If a partial or complete pathname
is specified then the pathname will be used directly.  An example of
the use of the "#include" directive is shown below:

        #cpoint This is a control point group.
                        :
                        :
        #include cpdata.sef
                        :
                        :
        #endcpoint

The contents of the file cpdata.sef will be inserted into the SEF at
the point where the "#include" directive is encountered.  Included files
may themselves contain "#include" directives.  The limit of the nesting
of included files is related to the number of files that can be opened
simultaneously in the language and operating system used.

3. Control Point Groups.

Control Point groups are used to specify points which have known
locations in space.  The most common use of control points is to
specify the geographical or UTM coordinates of benchmarks used as
reference points.  Control points may also be used to specify the
locations of points within a local unreferenced coordinate system.

3.1 Control Point Group directives.

A Control Point group begins with the "#cpoint <name>" directive and ends
with the "#endcpoint" directive.  Several additional directives are used
to direct the processing of control point data.

3.1.1 #units

The "#units" directive determines the units in which control points are
specified (not including elevation).  The valid forms of the "#units"
directive are:

        #units feet     Unreferenced feet
        #units meters   Unreferenced meters
        #units geog     Geographical (Lat/Long/Elev)
        #units utm      UTM coordinates

Geographical coordinates are specified as follows with "d" meaning
degrees, "m" meaning minutes, "s" meaning seconds, "x" meaning
the letter "E" or "W", and "y" meaning "N" or "S":

        Longitudes:     ddd-mm-ss.ssssx   ex. 109-10.23-3245W
        Latitudes:      dd-mm-ss.ssssy    ex. 46-12-45.0110S

The default units are unreferenced feet.  The "#units" directive may only
be specified prior to the first control point data line and may not be
changed again within a group.

3.1.2 #elevunits

The "#elevunits" directive specifies the units for elevation values.
The default is feet.  The "#elevunits" directive may only appear prior to
the first control point data line within a group and may not be changed
again within the group.  Valid "#elevunits" directives are:

        #elevunits feet
        #elevunits meters

3.1.3 #com

The "#com" directive is used to insert a comment into the General Comments
section of a SMAPS Control Point File.  A maximum of 16 comments may be
inserted, each comment may be 60 characters long.

3.1.4 #zone

The "#zone" directive is used to specify the zone to be used for a UTM
coordinate system.  An example "#zone" directive is shown below:

        #zone 16

3.2 Control Point Group data line format.

The default data line format uses simple fixed fields:

        Columns             Item
        ------- ----------------------------
        2-5     record type (SMAPS specific)
        6-17    control point name
        18-33   easting or longitude
        34-49   northing or latitude
        50-59   elevation

The input format may be modified by using the "#data" directive.  The
"#data" directive has several forms allowing the user to specify the
ordering of data items, the delimiters between data items, or the
starting column and/or width of each data item.  Several examples appear
below:

        #data station,east,north,elev

This specifies that the data will appear as the station name followed
by the easting, northing, and elevation separated by commas.  Extraneous
spaces are not allowed.  Any character may appear in place of the comma
as the delimiter.  The user must be careful that the delimiter character
does not conflict with valid data characters.  For example, a period
will conflict with the decimal point.  Only a single character may be
specified as the delimiter but the delimiter may be different between
each field.

        #data station north east elev

This specifies that data will be entered as station name followed by
northing, easting, and elevation each separated by an arbitrary number
of spaces.  A non-specified value may be indicated with an asterisk.

        #data station(12)east(16)north(16)elev(16)

This specifies the column widths of each data item.  The order of the
data items is the same as specified in the "#data" directive.  Since
column 1 has special significance, data fields start in column 2.

        #data station(2,12)north(16,16)east(34,16)elev(52,16)

This specifies the starting column and width of each data field.
The field specifiers will not be checked for overlap.  No data field
may begin in column 1.

The data format may be changed within a Control Point group.  The
format specifiers may be mixed and matched in any way that makes sense.

The allowable data items for Control Point Groups are:

         Name                            Item
        ------- -------------------------------------------------------
        type    record type (SMAPS feature, 4 ASCII characters max)
        station control point name (12 chars max, no embedded blanks)
        east    easting, longitude, or x coordinate (negative => west)
        north   northing, latitude, or y coordinate (negative => south)
        elev    elevation, or z coordinate.

3.3 Embedded comments.

Any line appearing in a group which does not have a blank in column 1
will be treated as a comment.  During an import operation the text of
the comment will be placed in the Control Point File as an in-line comment.
During an export operation any in-line comments in the Control Point
File will be written in a manner that will guarantee a non-blank character
appears in column 1.

4. Compass and Tape Survey Groups.

Compass and Tape Survey Groups serve as the major data type in cave
surveys.  The basic format for specifying Compass and Tape Survey groups
is the same as that of the Control Point groups the only difference being
the directives and the data items.

4.1 Compass and Tape Survey Directives.

Compass and Tape Survey groups always begin with a "#ctsurvey <name>"
directive and end with an "#endctsurvey" directive.  Note: the equal
sign is optional with all directives in SEF.  The following
directives are available for Compass and Tape Survey Groups:

    Directive                    Description                 Default
    ---------   -------------------------------------------- -------
    #atc=x      Aux tape correction (x=#units)                  0
    #atdec=x    Auxiliary decimal places                        2
    #atid=x     Auxiliary tape identification                   None
    #bcc=x      Backsight compass correction (x=degrees)        0
    #bcdec=x    Backsight compass decimal places (x=places)     2
    #bcid=x     Backsight compass identification                None
    #bic=x      Backsight incline correction (x=degrees)        0
    #bidec=x    Backsight incline decimal places (x=places)     2
    #biid=x     Backsight inclinometer identification           None
    #clinerr=x  Max allowable fs/bs inclinometer error          2
    #com ...    General survey comment (max 16 #comment
                        directives, 60 characters each)         None
    #compbs=x   Compass backsight type (normal or corrected)    Norm
    #comperr=x  Max allowable fs/bs compass error               2
    #date=x     Survey date (mm/dd/yyyy)                        None
    #decl=x     Declination (added to compass readings,units are
                        degrees)                                0
    #duty ...   Survey team member duty (max 8 #duty
                        directives, 20 characters each)         None
    #fcc=x      Foresight compass correction (x=degrees)        0
    #fcdec=x    Foresight compass decimal places (x=places)     2
    #fcid=x     Foresight compass identification                None
    #fic=x      Foresight incline correction (x=degrees)        0
    #fidec=x    Foresight incline decimal places (x=places)     2
    #fiid=x     Foresight inclinometer identification           None
    #incbs=x    Inclinometer backsight type (normal or corrected) normal
    #mtc=x      Main tape correction (x=#units)                 0
    #mtdec=x    Main tape decimal places                        2
    #mtid=x     Main tape identification                        None
    #person ... Survey team member name (max 8 #person
                        directives, 20 characters each)         None
    #tapemethod=x Taping method. Options available are:         ss
                        is = instrument to station
                        it = instrument to target
                        ss = station to station
                        st = station to target
    #units=x    Linear units (feet or meters)                   feet

All angular measurements are in degrees.  These directives must be
specified prior to any data lines within a group.

4.2 Data line format.

The data line format for Compass & Tape Survey group data lines follows
the same scheme as Control Point data lines.  A "#data" directive is used
to describe the ordering and format of each line.  The available data
items are described below:

        Item           Description
        ----    -------------------------
        type    record type (SMAPS feature, 4 ASCII characters max)
        from    station from (12 characters max, no embedded blanks)
        to      station to (12 characters max, no embedded blanks)
        dist    distance between stations
        fazi    forward azimuth
        bazi    back azimuth
        finc    forward incline
        binc    back incline
        left    distance to left wall
        right   distance to right wall
        ceil    distance to ceiling
        floor   distance to floor
        iab     instrument above station
        tab     target above station
        vdist   vertical distance (between from and to)

Passage dimensions are measured relative to the from station looking
towards the to station.  The passage dimension of the last station in
a dead-end sequence may be specified by placing the station name in the
from field and the left, right, ceiling, and floor in the appropriate
fields.  The measurements are assumed to be perpendicular to the survey
shot that connects to the dead-end station.  The data line containing
the dead-end station must immediately follow the line containing the
survey shot connecting to it.  The following is an example:

        a       b       <dist,azi,incl here>    l r c f
        b                                       l r c f

The default format of a data line is as follows:

        Column          Item
        ------          -----
        2-5             type
        6-17            from
        18-29           to
        30-39           dist
        40-49           fazi
        50-59           bazi
        60-69           finc
        70-79           binc
        80-89           left
        90-99           right
        100-109         ceil
        110-119         floor
        120-129         iab
        130-139         tab
        140-149         vdist

The default line format may be overridden by using a "#data" directive
in the same manner as used in Control Point groups.  Multiple "#data"
directives may be used to change the data line format within a group.

4.3 Embedded comments.

Any line appearing in the group which does not have a blank in column 1
will be treated as a comment.  During an import operation the text of
the comment will be placed in the Compass and Tape Survey file as an
in-line comment.  During an export operation any in-line comments in
the Compass and Tape Survey file will be written in a manner that will
guarantee a non-blank character in column 1.

5. Directory tree control directives.

SMAPS utilizes a hierarchical (tree structured) file system to organize
files.  This structure is quite flexible and has proven to be a very
powerful and usable paradigm.  During an SEF export operation, directives
are generated which will allow the directory structure to be recreated
during a subsequent import operation.  These directives must appear
outside of any group and may be safely ignored by programs utilizing
arcane flat file systems.

5.1 #dir

The "#dir" directive may have any of the following formats:

        #dir <directory name>

                or

        #dir (tag) <directory name>

                or

        #dir (tag)


<directory name> is a character string of up to 40 characters which
will be used as the directory name within SMAPS.  The tag field may
be used to attach a simple identifier to a directory.  This is used
to re-enter a previously created directory without having to correctly
type the long descriptive name.  If the tag is not given, then a new
directory is created regardless if it already exists.  Several examples
here should help clarify matters:

        #dir Trout Rocks Caves

This will create a directory named "Trout Rocks Caves" and make it
the current directory.  All groups imported will be placed into this
directory until the directory is changed by another directive.

        #dir (a) Trout Cave

Operates the same as the previous example except the tag "a" may now be
used as a synonym for the Trout Cave directory.  The Trout Cave
directory is made current and will receive all imported groups until
another directive changed to another directory.  Since the tag a has
now been used, it cannot be used again in conjunction with a
descriptive name.

        #dir (a)

This directive will move back to the Trout Cave directory regardless
of what directory is currently active.

The SMAPS limitation on directory levels is 10.  If a directory becomes
filled, then a new directory is automatically created as the last entry
in the current directory.  Further groups will be placed in the new
directory.  This process repeats as necessary.

5.2 #initdir

The "#initdir" directive moves back to the original directory that was
active when the import operation was started.  It is not possible to
move to a directory that is above the directory that was current when
an import operation was started.

5.3 Building a directory tree.

The following example shows a straightforward method of building a
directory tree.  The use of the "#include" directive makes the task
simpler by allowing the data to be grouped into separate files.

        #dir (trout) Trout Rocks Caves
        #dir Trout Cave
        #include trout.sef
        #dir (trout)
        #dir New Trout Cave
        #include newtrout.sef
        #dir (trout)
        #dir Hamilton Cave
        #include hamilton.sef

The previous example creates a tree of the following structure:

                        +-------------------+
                        + Trout Rocks Caves +
                        +-------------------+
                             |    |    |
              +--------------+    |    +--------------+
              |                   |                   |
              V                   V                   V
      +----------------+  +----------------+  +----------------+
      |   Trout Cave   |  | New Trout Cave |  | Hamilton Cave  |
      +----------------+  +----------------+  +----------------+

6. Software availability

An SEF import processor is available free of charge from Speleotechnologies,
P.O. Box 293, Frostburg, Maryland 21532-0293.  The software is written in
ANSI C and compiles under Microsoft C Version 6.0a or later.  As distributed,
the processor is inthe form of a standalone program which will convert SEF
to a fixed column format.  The program is not intended to be used as an
as-is utility but rather as a template for developing import processors
for other survey processing systems.

#: 1002 S0/CompuServe Mail  [MAIL]
    07-Jun-92 00:10 MDT
Sb: #3441: SEF Specification Update
Fm: >INTERNET:cavers@m2c.org


Sender: jds@m2c.org
Received: from M2C.M2C.ORG by ihc.compuserve.com (5.65/5.910516)
        id AA25629; Sun, 7 Jun 92 02:09:36 -0400
Received: by m2c.m2c.org (5.57/sendmail.28-May-87)
        id AA15723; Sun, 7 Jun 92 02:05:19 -0400
Return-Path: <jds@zeus.m2c.org>
Received: by zeus.m2c.org  id AA12519; Sun, 7 Jun 92 02:04:11 -0400
Date: Sun, 7 Jun 92 02:04:11 -0400
Message-Id: <9206070604.AA12519@zeus.m2c.org>
To: realcavers@m2c.org
From: cavers@m2c.org (Cavers Forum)
Reply-To: cavers@m2c.org (Cavers Forum)
Errors-To: cavers-request@m2c.org
X-Reminder-1:  *** Do Not Reproduce This Message  ***
X-Reminder-2:  *** Without Permission From Author ***
Originally-From: Doug Dotson <e2cs002@fre.fsu.umd.edu>
Subject: #3441: SEF Specification Update


From: Doug Dotson <e2cs002@fre.fsu.umd.edu>
Date: Sat, 06 Jun 1992 23:04:58 EDT
Subject: SEF Specification Update

Dear SEF Enthusiasts (you know who you are):

As a result of constructive input from Bill Putnam, Mel Park,
John Halleck, and a few others.  I have decided to include the
following changes to SEF as of this time.  These suggestions were
well thought out and I feel enhance the usability of SEF.

-------------------------------------------------------------------------
These changes are related to the handling of directories during the
import process:

"#up" moves up 1 directory level.  If at the root, an error results
and the import process stops.

"#root" moves to the root directory in the filesystem.

"#dir <name>" enters the directory specified by <name> if it exists.
If it does not exist, it is created and entered.  Spelling is important
here but leading and trailing spaces are ignored.  <name> can be up to
40 characters long.  Tags are no longer supported since their use can
be duplicated by use of "#up", "#root", and "#dir".

"#initdir" enters the directory which was current when the import
operation was initiated.

-------------------------------------------------------------------------
These changes deal with duplicate data file names:

If a data file (currently control point file or survey file) group
is imported and a file already exists with an identical name, the user
will be prompted as to whether the existing file should be overwritten
or whether a new file with the same name should be created.

A new directive "#confirm off" has been implemented which can be placed
in an SEF file (anywhere) to bypass the confirm.  If confirm is off,
any existing file will be overwritten without verification.
"#confirm on" enables confirmation.  The default is "#confirm on".

---------------------------------------------------------------------
Another aspect of SEF that arose during discussion is that many SMAPS
users would like to use SEF as a means of distributing updates to other
SMAPS users.  Enhancements are being considered that will allow data to
be exchanged using SEF without the loss of any information currently
represented in SMAPS files (such as angular units).  Several new
directives will be added to enable this.  These directives may be ignored
by non-SMAPS users.

------------------------------------------------------------------
Export to SEF operations in SMAPS now have the following options:

If the file specified to contain SEF data already exists, the user will
be prompted as to whether the new data should be appended to the existing
file, or whether the new data should replace the existing data.  This
allows multiple updates to be placed in the same SEF file.

The user will also be prompted as to whether the output data should be
"absolute" or "relative".  If "absolute" is selected then each group
will be prefixed by a "#root" directive followed by "#dir" directives
to describe the complete path of each group within the directory tree.
If "relative" is selected, "#up" and "#dir" directives will be inserted
to describe the movement through the tree as the export proceeds.

It is not recommended that "relative" data be appended to an existing file
unless the user is keenly aware of the structure implied.

Keep up the good (constructive) work!

Doug.




d.

#: 1029 S0/CompuServe Mail  [MAIL]
    09-Jun-92 19:36 MDT
Sb: #3468: Update to SEF Specs
Fm: >INTERNET:cavers@m2c.org


Sender: jds@m2c.org
Received: from M2C.M2C.ORG by ihc.compuserve.com (5.65/5.910516)
        id AA16298; Tue, 9 Jun 92 21:33:00 -0400
Received: by m2c.m2c.org (5.57/sendmail.28-May-87)
        id AA14954; Tue, 9 Jun 92 21:29:41 -0400
Return-Path: <jds@zeus.m2c.org>
Received: by zeus.m2c.org  id AA27738; Tue, 9 Jun 92 21:28:50 -0400
Date: Tue, 9 Jun 92 21:28:50 -0400
Message-Id: <9206100128.AA27738@zeus.m2c.org>
To: realcavers@m2c.org
From: cavers@m2c.org (Cavers Forum)
Reply-To: cavers@m2c.org (Cavers Forum)
Errors-To: cavers-request@m2c.org
X-Reminder-1:  *** Do Not Reproduce This Message  ***
X-Reminder-2:  *** Without Permission From Author ***
Originally-From: Doug Dotson <e2cs002@fre.fsu.umd.edu>
Subject: #3468: Update to SEF Specs


From: Doug Dotson <e2cs002@fre.fsu.umd.edu>
Date: Tue, 09 Jun 1992 14:58:51 EDT
Subject: Update to SEF Specs

Another Update to the SEF Spec
------------------------------

Several new directives have been added to SEF as a result of
suggestions from folks.

1) A new directive "#replace on" or "#replace off" has been implemented.
The default is "#replace off".  This allows updates to be handled without
user intervention.  If replace is off then a new file will be created
with the same name as the existing file.  In systems where duplicate
names are not allowed, the new file's name would have to be modified in
some subtile way.  I suspect appending a digit corresponding to some
kind of version number.  If replace is on, then the existing file will be
replaced with the new file.  This feature along with the absolute
pathnames suggested by Bill Putnam, allows existing filesystems to be
updated with a minimum of intervention.

The "#confirm off" and "#confirm on" directives (previously mentioned)
allow the user to make a decision whenever a duplicate situation
is detected.  The default is "#confirm on".

******** WARNING *** WARNING *** WARNING *** WARNING *** WARNING ********
**** SMAPS haters do not read beyond this point or damage may result :-)

2) The following directives are intended for SMAPS support ONLY!

Many SMAPS users have expressed interest in using SEF for exchanging
data between SMAPS systems.  Unfortunately, information would be
lost in such a transfer because several SMAPS-related parameters are
not placed in an SEF file when exported.  This is because SEF was not
originally intended to be for SMAPS-SMAPS transfers but rather for
import and export between SMAPS and other programs.

These have to do with the instrument units.  The following directives
have been implemented to remedy this:

        #fcunits <cunits>       Foresight compass units
        #bcunits <cunits>       Backsight compass units

          where <cunits> is:
                degrees
                mils
                grads
                bearingdms              i.e. N23-45-12.34E
                bearingdec              i.e. N23.76E

        #fiunits <iunits>       Foresight inclinometer units
        #biunits <iunits>       Backsight inclinometer units

          where <iunits> is:
                degrees
                mils
                grads

        #mtunits <tunits>       Main tape units
        #atunits <tunits>       Aux tape units

          where <tunits> is:
                feet
                meters
                ftin
                centimeters

IMPORTANT!!!  These directives in no way affect the fact that all angular
values in SEF are in degrees and linear units are in feet or meters as
described by the "#units" directive.  SMAPS internally stores all angular
measurements in degrees and all linear measurements in meters.  These
directives simply allow data as recorded in SMAPS to maintain the
original units during a transfer.  The "#units" directive continues to
allow international biases to be accomodated.

These directives may be completely ignored by non-SMAPS systems or may
be treated as comments for documentation purposes only.

These directives do allow additional information to be maintained about
the original units in which the measurements were recorded.  This is
imformation that should be kept associated with the data if it is
available.

Any more suggestions?

Doug.

e

