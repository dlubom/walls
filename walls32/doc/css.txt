====================================================================
APPENDIX E
====================================================================

SURVEY DATA FILE FORMAT

These files are the polar coordinates and associated information that
make up the original survey data.  They are ordinarily created by CAVEDT,
but are so designed that if you wish, you can produce or edit them in a
text editor or word processor, as long as the file format is maintained.

This section describes in detail the current raw survey data format.
Listed below you will see a sample survey file. The layout has been
compressed slightly so the file will fit on the page, but all the
fields are correct:

SECRET CAVE
SURVEY NAME: A
SURVEY DATE: 7 10 79  COMMENT:Entrance Passage
SURVEY TEAM:
D.SMITH,R.BROWN,S.MURRAY
DECLINATION:    1.00  FORMAT: DDDDLUDRADLN  CORRECTIONS:  2.00 3.00 4.00

FROM TO  LENGTH BEARING  DIP    LEFT    UP  DOWN RIGHT

 A2  A1   12.00  135.00   5.00  0.00  4.00  0.50  0.00  Big Room
 A2  A3   41.17   46.00   2.00  0.00  0.00  0.00  0.00  #|PC# Room
 A3  A4    4.25   15.00 -85.00  5.00  3.50  0.75  0.50
 A4  A5   22.50  129.00 -21.00  0.00  0.00  0.00  0.00  #|PX#
<form feed>
SECRET CAVE
SURVEY NAME: B
SURVEY DATE: 7 10 79  COMMENT:Big Room Survey
SURVEY TEAM:
D.SMITH,R.BROWN,S.MURRAY
DECLINATION:    1.00  FORMAT: DDDDLUDRADLN  CORRECTIONS:  2.00 3.00 4.00

FROM TO   LEN  BEAR   INC LEFT   UP DOWN RIGHT AZM2 INC2 FLAGS COMMENTS

 B2  B1  13.0  35.0  15.0 -9.9  2.0  1.5  1.0 215.0 -15.0      Side Passage
 B2  B3  22.1  16.0  22.0  6.0  1.0  0.0  2.0 196.0 -22.0 #|PC#
 B3  B4   3.2  11.0 -82.0  2.0  2.5  2.7  3.5 191.0  82.0
 B4  B5  23.5 111.0  11.0  0.0  0.0  1.0  1.0 291.0 -11.0 #|PX#
<form feed>

1. Individual Surveys.

You will notice that the file contains data for two individual
surveys. COMPASS survey files can have any number of surveys within a
single file. All surveys end with a form feed character (hex 0C) on a
separate line. Thus if there are multiple surveys in a file, each
survey is separated by a form feed. In some word processors, the form
feed may not be obvious and can be deleted without your knowledge;
this will make the file work improperly in COMPASS.

Depending on the editor, the form feed may appear as the female
symbol, ^L, L in reverse video, or some other symbol. In WordPerfect
a form feed may be entered in two ways: hold down ALT, type 12 on the
numeric keypad, then raise ALT; or press CTRL-ENTER. By the first
method it will initially appear on the screen as a female symbol; by
the second as a double line across the page. No matter how created,
when saved as DOS text and retrieved in WordPerfect, it will show as
the double line, associated with a hidden [HPg] code (deleting this
code will delete the form feed). When read in DOS the same text will
show the female symbol. (See also Appendix D, section 4.)

2. The Header.
 
Each survey begins with a header that gives information about the
survey that will follow. The following list describes each header
item:

     a. Cave Name. (Line 1)

     The first line contains the cave name. It can be any
     alphanumeric characters up to 80 characters in length. It is
     terminated by a carriage return and line feed. For the most
     part, the software ignores the cave name.

     b. Survey Name. (Line 2)

     The survey name is usually the alphabetic prefix that is
     attached to each survey station. For example, if the survey
     name is AB, then the individual survey stations will be AB1,
     AB2, AB3.. etc. The survey name field begins with the
     string: "SURVEY NAME: ", which is followed by the actual
     survey name. The name can be any printable ASCII character
     and is terminated by the first white space character,
     usually end-of-line characters. It can be up to eight
     characters in length.

     c. Survey Date. (Line 3)

     The date field begins with the string "SURVEY DATE: " and is
     followed by three numerical date fields: month, day and
     year. Year can be a two digit or four digit number, i.e.
     1992 or 92.

     d. Survey Comment. (Line 3)

     For backward compatibility, this item is optional. It is used to
     describe the survey in more detail than the Survey Name. The
     survey comment begins with the string "COMMENT:" and is
     terminated by the Carriage Return at the end of the line. The
     actual comment begins immediately after the colon ":" character.

     e. Survey Team. (Line 4)

     The survey team fields consists of two lines. The first line
     contains the string: "SURVEY TEAM:". No other information
     appears on this line. The next line holds the actual survey
     team information. The survey team information can be up to
     100 characters in length. There is no specific format to
     this information. It is up to the user.

     f. Declination. (Line 5)

     The declination field gives the magnetic declination for a
     particular region. It is used to compensate for local
     magnetic anomalies and differences between compasses. The
     declination field begins with the string "DECLINATION: "
     followed by a floating point number. This number is added to
     the azimuth of each shot in the survey.

     g. File Format. (Line 5)

     For backward compatibility, this item is optional. This
     field specifies the format of the original survey notebook.
     Since COMPASS converts the file to fixed format, this
     information is used by programs like the editor to display
     and edit the data in original form. The field begins with
     the string: "FORMAT: " followed by 11 or 12 upper case
     alphabetic characters. Each character specifies a particular
     part of the format. Here is list of the format items:


       1. Bearing Units: D = Degrees, Q = quads, R = Grads
       2. Length Units: D = Decimal Feet, I = Feet and Inches
          M = Meters
       3. Passage Units: Same as length
       4. Inclination Units: D = Degrees, G = Percent Grade
          M = Degrees and Minutes, R = Grads  W = Depth Gauge
       5. Passage Dimension Order: U = Up, D = Down, R = Right
          L = Left
       6. Passage Dimension Order
       7. Passage Dimension Order
       8. Passage Dimension Order
       9. Shot Item Order: L = Length, A = Azimuth,
          D = Inclination
       10. Shot Item Order
       11. Shot Item Order
       12. B=Redundant Backsignt N or empty=No Redundant Backsights.

     h. Instrument Correction Factors. (Line 5)

     For backward compatibility, this item is optional. The item
     begins with the string "CORRECTIONS:". The Instrument Correction
     Factors are used to correct defective instrument readings. There
     are three numbers which are used to correct the compass,
     inclinometer and tape readings respectively. These values are
     added to the azimuth, inclination and length values for the
     survey. The azimuth and inclination readings are in degrees and
     the length value is in feet.
     
     
3. Survey Shots.

Following the header are three lines which serve to separate the
header from the shots. The middle line identifies each field in the
shot. Their purpose is only to make the file more readable. They are
ignored by all software.

Following the separating lines are a series of shots. Each shot is
contained on a single line. There are eleven possible items on the
line. Some items are optional.

     a. From Station.

     The first item on the line is the "from" survey station
     name. It consists of eight printable ASCII characters. It is
     terminated by the first white space character. It is case
     sensitive. In the normal situation, the "from" station is
     defined as the station whose location has already been
     established, whereas the "to" station is the station whose
     location is about to be established. In the case of a
     backsight, the reverse is true.

     b. To Station.

     The second item on the line is "to" survey station name. It
     consists of eight printable ASCII characters. It is
     terminated by the first white space character. It is case
     sensitive.

     c. Length.

     This is the length of the shot between the from and to
     stations. It is a single floating point number of virtually
     any format. It is terminated by the first white space
     character. It specifies length in decimal feet.

     d. Bearing.

     This item specifies the compass angle of the shot. It is a
     single floating point number of virtually any format. It is
     terminated by the first white space character. It specifies
     bearing in decimal degrees.

     e. Inclination.

     This is the angle of inclination of the shot. It is a single
     floating point number of virtually any format. It is
     terminated by the first white space character. It specifies
     inclination in decimal degrees.

     f. Left.

     This is the distance between the station and the left wall.
     It is a single floating point number of virtually any
     format. It is terminated by the first white space character.
     It specifies distance in decimal feet.

     g. Up.

     This is the distance between the station and the ceiling. It
     is a single floating point number of virtually any format.
     It is terminated by the first white space character. It
     specifies distance in decimal feet.

     h. Down.

     This is the distance between the station and the floor. It
     is a single floating point number of virtually any format.
     It is terminated by the first white space character. It
     specifies distance in decimal feet.

     i. Right.

     This is the distance between the station and the right wall.
     It is a single floating point number of virtually any
     format. It is terminated by the first white space character.
     It specifies distance in decimal feet.


     j. Azm2.

     For backward compatibility, this is an optional item. It is
     turned on or off with the File Format item in the header. If
     redundant backsights are enabled, this is the backsighted
     azimuth value. The second survey in the listing above has
     backsights enabled. This value is always stored uncorrected, so
     it should be 180 degrees from the bearing. An editor may choose
     to display it as a corrected backsight, in which case, it should
     equal the bearing.

     Note: redundant backsights are different from ordinary backsights.
     A redundant backsight consist of an extra compass and inclination
     reading. This is normal done to increase the accuracy of a survey.
     An ordinary backsight occurs where it is more convient to measure
     a shot in reverse order. For example, you could do an ordinary
     backsight when there is a rock that interfers with the "from"
     station. In COMPASS, ordinary backsights are simply entered in
     reverse. COMPASS is expected to notice that the shot is reversed
     and handle it.


     k. Inc2.

     For backward compatibility, this is an optional item. It is
     turned on or off with the File Format item in the header. If
     redundant backsights are enabled, this is the backsighted
     inclination value. The second survey in the listing above has
     backsights enabled. This value is always stored uncorrected, so
     it should be the same value as the inclination with sign
     changed. An editor may choose to display it as a corrected
     backsight, in which case, it should equal the inclination.

     l. Flags.

     For backward compatibility, this is an optional item. It
     specifies a set of flags that modify the way in which this
     shot is processed. To distinguish the flag field from the
     comment field that follows, flags must be preceded by two
     characters, a pound sign and a vertical bar: "#|". This is
     followed by up to three printable characters. The flag field
     is terminated by a single pound sign "#" character. At this
     time there are four flags that are recognized:

       L - Exclude this shot from length calculations.
       P - Exclude this shot from plotting.
       X - Exclude this shot from all processing.
       C - Do not adjust this shot when closing loops.

     m. Comments.

     For backward compatibility, this field is optional. It
     contains a comment pertaining to this shot. It can be up to
     80 characters in length, and it terminates at the
     end-of-line.

Lines in survey files may be longer than the normal computer screen
width. When working with them in non-COMPASS editors, be sure that the
editor does not wrap the lines around, or the file may be corrupted
when saved. In word processors, you may need to select wide margins
and/or a paper size wide enough to accommodate the longest line without
wrapping. Then save as ASCII text.


====================================================================
APPENDIX F
====================================================================

PLOT FILE FORMAT

The plot file is the compilation of data files reduced to Cartesian
coordinates, a step that is necessary as a practical basis for drawing
the cave. Plot files are used by video drivers, plotter drivers and printer
drivers to produce displays of the cave. Plot files are normally compiled by
CRUNCH, but like COMPASS data files, they are in ordinary ASCII text, so
that you have the option of editing or even creating them in text editors
if you already have the necessary Cartesian coordinates from any source.

Plot files contain two basic kinds of information: vector information and
feature information. Vector information is data that tells the computer
how to draw lines that describe the cave. Feature information contains
the locations, magnitudes and routes associated with cave features. Cave
features can be almost anything that you might want to study in a cave.
For example, features could be formations, minerals, water, GIS
information, scientific data, etc.

The plot file consists of a series of commands that direct the device
driver to perform some specific action. Commands are line oriented. The
first character on each line is treated as a command. In some instances,
other letters on the same line indicate optional parameters or
subcommands. Arguments to the command appear on the rest of the line.
Here is a list of commands:

1.  N<survey name> D <month> <day> <year>

This command specifies that we are working on a new survey. It is
used by the device driver to selectively display certain surveys, or
to color each survey a different color. An ASCII text string
containing the survey name immediately follows the letter "N". The
survey date follows the survey name. The survey date is preceeded by
the letter "D" and it is written numerically as Month, Day and Year.
The Year is expected to be the full year like 1994 not 94.


2. F<survey name>

The "F" command has the same format as the "N" command. The "F"
command identifies the start of a feature survey. Programs use the
command to separate features from surveys. An ASCII text string
containing the name of the feature item immediately follows the letter "F".

The "R" command may optionally follow the "F" command and the feature
name. It is followed by two floating point numbers which specify the
range of values that will be encountered in the feature block. Programs
use the range of values to scale their response to individual feature
values.


3.  D,M

These commands begin a shot vector data record. The following fields
are contained within the record:

     a. Plot Command. Consisting of: Upper-case "D" or "M." "D"
     indicates that the plotting device should draw a line from
     the last location to the location specified by the Cartesian
     point that follows. "M" indicates that the plotting device
     should move to the specified location without drawing a line.
     "M" must precede the numbers in the first coordinate line, and
     those in any branch from a linear sequence.
     
     b. Cartesian Coordinates. Consisting of: Three floating point
     numbers specifying a location North, East and Vertical from
     the origin of the cave. In normal COMPASS files, these are
     taken one place right of the decimal point, but the programs
     will also accept figures of higher precision.

     c. Station Label Command. Consisting of: The letter "S"
     followed by up to eight characters of station label.

     d. Passage Dimension Command. Consisting of: The letter "P"
     followed by four floating point numbers specifying the left, up,
     down and right dimensions of the station. The "P" command and
     following numbers are optional, and can be omitted without
     preventing the file from working.

4. L

The format of "L" command is identical to the "D" and "M" command
except that it indicates the location of a GIS feature rather than
the start or end of a vector. Programs use this command to place a
symbol at certain locations on the map to identify a feature.

The optional "V" command follows the "P" command. It is used to specify
the value associated with a particular feature item. For example, if a
water sample showed 5 parts per million contamination, the value of the
item might be 5 or 5E-6. The number is usually specified in scientific
notation format. For exampe: 1.2345E-6. This ensures that a broad range
of numbers can be handled.


5. Z<N min><N max><E min><E max><V min><V max>

The command lists the minimum and maximum dimensions of the cave
being processed. Normally, this command is the first command in the
plot file. It allows the device driver to scale the plot automatically
without scanning through the whole cave. In files created by CRUNCH,
these numbers will represent the most extreme positions of each
dimension with respect to the starting point, so that Overview mode
in VIEW will draw the cave in contact with three of the box walls.
In manually created or modified files, you may use any numbers that
are farther from the point of origin than the real extremes, in which
case the cave will "float" out of contact with the walls in Overview.

6. X<N min><N max><E min><E max><V min><V max>

This command follows each survey in the file, and lists the minimum and
maximum dimensions of that survey. This greatly speeds redrawing the
cave when changing scale, by allowing the program to tell if the survey
will be visible on the screen.

7. S<section name>

This command signifies the beginning of a new section in the cave.
Normally, this would mark the beginning of new file. It is used by
programs to color, highlight or exclude particular parts of the cave.

Here is a sample plot file:

Z    -129.26    319.44    -94.30    439.00   -130.05    126.30                            
SFULFORD
NZ+ D 6 29 1994
D   123.5   -70.2   -87.1  SZ6  P    1.5    1.0    0.5    0.5
D   128.2   -65.9   -86.8  SZ7  P    0.0    3.0    1.0    3.0
D   131.1   -65.4   -85.3  SZ8  P    3.5    2.0    5.0    1.0
D   138.2   -63.3   -82.5  SZ9  P    0.0    0.0    0.0    0.0
M   123.5   -70.2   -87.1  SZ6  P    1.5    1.0    0.5    0.5
D   118.8   -79.1   -92.5  SZ10  P    1.5    1.0    2.5    3.0
D   122.0   -75.8   -95.4  SZ11  P    2.5    0.5    2.5    1.5
D   129.8   -79.1  -101.7  SZ12  P    0.5    4.0    0.5    1.5
D   134.4   -82.9  -101.9  SZ13  P    0.0    0.0    0.0    0.0
X     118.78    138.22    -82.94    -63.34   -101.90    -82.53
FINSECTS
L     0.0     0.0     0.0  SA1 P -9.0 -9.0 -9.0 -9.0
L     8.6    17.2   -10.2  SA2 P -9.0 -9.0 -9.0 -9.0
L    30.5    23.3   -17.2  SA3 P -9.0 -9.0 -9.0 -9.0
L    37.5    12.4   -20.3  SA4 P -9.0 -9.0 -9.0 -9.0
X       0.00     37.50      0.00     23.30    -20.30      0.00
FWATER R 5.51234E2  8.12341E2
L     0.0     0.0     0.0  SA1 P -9.0 -9.0 -9.0 -9.0 V 5.51234E2
L     8.6    17.2   -10.2  SA2 P -9.0 -9.0 -9.0 -9.0 V 8.12341E2
L    30.5    23.3   -17.2  SA3 P -9.0 -9.0 -9.0 -9.0 V 7.82543E2
L    37.5    12.4   -20.3  SA4 P -9.0 -9.0 -9.0 -9.0
X       0.00     37.50      0.00     23.30    -20.30      0.00

The spacing of the elements in the file is not critical, provided that
at least one white space separates each item.  However, the file must be
saved in ASCII text format, with a carriage return/line feed ("hard return"
in word processors) ending each line. Omission of these (as by forgetting to
press the return key at the end of the last line) will cause a "I2L ERROR"
message when the program analyzes the file before drawing the cave.
