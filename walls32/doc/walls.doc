Some Preliminary Notes on WALLS Data Format
===========================================

The files accepted by WALLS are of two basic types, survey data files
(*.SRV) and project files (*.PRJ). Although both types can be created
with any editor capable of handling standard DOS text files, a separate
program is not required.

PROJECT FILES

The project files do not contain actual survey data, but are simply a
means of organizing groups of data files into convenient tree-like
heirarchies. This facilitates selecting subsets of data for various
types of operations, including initial processing. The project
heirarchies do not necessarily imply anything about physical, or
geographical, relationships between surveys. Two different heirarchies
will define exactly the same network geometry if they reference the same
set of data files. (This geometry can consist of multiple connected
components.) The data files are self-contained in the sense that WALLS
can process them in any order, either singly or in arbitrary groupings.
Likewise, the project heirarchies do not necessarily correspond to
MS-DOS directories where files are physically located.

To understand the project file format let's first examine how projects
are presented to the user. A file open dialog in WALLS allows the user
to select the desired project file -- usually from a list of files with
extension .PRJ. The program initially scans the file and displays a tree
diagram very similar to the ones used by various Windows file manager
applications. For example, the contents of a project window (without the
open/closed book icons and appropriate shading/coloring) might resemble
the following:

ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³         PEP.PRJ - PEP Project Status Dec 89          ³
³                                                      ³
³   TECOLO: Yerba Buena Area..                         ³
³   SISTEMA: Sistema Purificacion                      ³
³   ÃÄÄÄSURF89: 1989 Surface Surveys                   ³
³   ³   ÀÄÄÄs1: Oyamel-Brinco-Borrego (Apr 1989)       ³
³   ÃÄÄÄOYAMEL: Cueva Oyamel..                         ³
³   ÃÄÄÄBRINCO: Brinco Area                            ³
³   ³   ÃÄÄÄBalcony: Entrance to Balcony (1983)        ³
³   ³   ÀÄÄÄVALHALLA                                   ³
³   ³       ÃÄÄÄval85: 1st survey Nov 24-26,1985       ³
³   ³       ÀÄÄÄval86: Sprouse 4/86                    ³
³   ÀÄÄÄBORREGO: Cueva del Borrego..                   ³
³                                                      ³
ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ

In the above view certain tree nodes are "collapsed" (TECOLO, OYAMEL,
BORREGO) and others are "expanded" to greater depth. TECOLO and SISTEMA
are separate projects -- the roots of two distinct trees defined in the
project file. Since WALLS will not process as a group -- or display in a
single window -- surveys from separate projects, this would normally
indicate that TECOLO and SISTEMA are not connected geographically (have
stations in common).

A portion of the corresponding project file, PEP.PRJ, is given below.
PROJECTs, BOOKs, and SURVEYs are analogous to the drives, directories,
and files of MS-DOS. Notice that MS-DOS pathnames (relative to the
project file's directory) are used to specify the actual locations of
data files. Val86 has project location "sistema:\brinco\valhalla\val86".
Its location on disk could be "c:\walls\prj\caves\val86.dat".

TITLE "PEP Project Status Dec 89"
PROJECT tecolo "Yerba Buena Area"
...
PROJECT sistema "Sistema Purificacion"
  BOOK \surf89 "1989 Surface Surveys"
    SURVEY surface\s1.dat "Oyamel-Brinco-Borrego (Apr 1989)"
  BOOK \oyamel "Cueva Oyamel"
  ...
  BOOK \brinco "Brinco Area"
    SURVEY caves\balcony.dat "Entrance to Balcony (1983)"
    BOOK valhalla
      SURVEY caves\val85.dat "1st Survey Nov 24-26,1985"
      SURVEY caves\val86.dat "Sprouse 4/86"
  BOOK \borrego "Cueva del Borrego"
  ...

Although they can be edited directly, project files are normally
maintained via the WALLS graphical interface. The user can manipulate
the tree diagrams by using fairly conventional mouse and keyboard
techniques. For example, double-clicking a project or book node, will
expand (or collapse) the corresponding branch. Double-clicking a survey
will activate an edit window for the corresponding data file. The
project heirarchies are easily revised by "dragging" projects, books, or
surveys to new locations in the diagram.

By simply clicking (or highlighting) a tree node, the corresponding data
subset is "selected" for some sort of toolbar or menu operation. These
operations include the following:

  1. Creation of a new project, book, or survey, or the attachment
     of an existing survey. A dialog box is presented to the user.
     Unlike MS-DOS directory structures, all item names must be unique,
     regardless of their position in the heirarchy. This restriction
     is due to the program's need to create similarly named binary
     files in a common DOS directory. (See item 5.)

  2. Deletion. The branch is deleted from the project file and all
     corresponding data files are deleted.

  3. Detachment. The branch is deleted from the project file but
     no data files are actually deleted.

  4. Disabling (greying) or enabling. The survey or book will be
     excluded or included in an operation involving a parent book
     or project.

  5. Processing and/or adjustment of all data files in the branch. This
     can create one or more binary files whose names are formed from the
     name of the selected item. For example, processing the book BRINCO
     will create a binary file, brinco.ntv, containing processed data
     from balcony.dat, val85.dat, and val86.dat.

To summarize: The project file specifies the identity and locations of
data files that make up one or more projects. It also defines for each
project a hierarchy that facilitates selection and processing of named
groups of files. Unlike the branch heirarchy (described below), the
project heirarchy will often reveal more about how and when data were
obtained than about geography. A data file, while normally restricted to
a particular cave or area, is characterized by names of team members,
dates, types of instruments used, etc., and these attributes often
appear in the descriptive names assigned to BOOKs and SURVEYs.

Since such information will remain useful, and can be illustrated
graphically, WALLS saves as an attribute of each processed survey vector
its position in the project heirarchy. A vector's project attribute, for
example, might be "sistema:\brinco\valhalla\val86.1130", where 1130 is
the vector's corresponding line number in VAL86.DAT.

SURVEY DATA FILES

The survey data files, which contain information from field books in a
"script-style" text format, are completely self contained. This means
they have whatever special directives are needed for interpreting
the accompanying vector data, such as length and angle units, order and
meaning of numeric fields, etc. In particular, the information necessary
for forming a complete unique name for each referenced survey station
must appear in the same file, even though a "branch prefix" scheme
allows shortened (non-unique) names on the lines that define individual
vectors. If a name appears in multiple data files in a project, WALLS
will assume that only one geographical location is being referenced.
This means that many data files can together define a smaller number
connected networks.
